{% extends 'base/base.html' %}
{% block content %}

<div class="page-shell">
  <div class="page-header">
    <div>
      <h3>Available Grounds</h3>
      <p class="page-subtitle">Find a pitch by location, check pricing, and view live slot availability.</p>
    </div>
  </div>

  <div class="row g-4">
    {% for ground in grounds %}
      <div class="col-md-6 col-lg-4">
        <div class="card ground-card h-100">
          <div class="ground-media">
            {% if ground.image %}
              <img src="{{ ground.image }}" class="card-img-top" alt="{{ ground.name }}">
            {% else %}
              <img src="/static/images/ground_placeholder.svg" class="card-img-top" alt="{{ ground.name }}">
            {% endif %}
            <span class="ground-badge">Popular</span>
          </div>
          <div class="card-body d-flex flex-column">
            <h5 class="mb-1">{{ ground.name }}</h5>
            <p class="text-muted mb-3">{{ ground.location }}</p>
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="badge text-bg-warning">High demand evenings</span>
              <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#mapModal{{ ground.id }}">Map</button>
            </div>
            <a href="/grounds/{{ ground.id }}/" class="btn btn-primary w-100 mt-auto">View Slots</a>
          </div>

          <div class="modal fade" id="mapModal{{ ground.id }}" tabindex="-1" aria-labelledby="mapModalLabel{{ ground.id }}" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="mapModalLabel{{ ground.id }}">{{ ground.name }} location</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                  {% if ground.latitude and ground.longitude %}
                    <iframe width="100%" height="450" frameborder="0" style="border:0"
                      src="https://www.openstreetmap.org/export/embed.html?bbox={{ ground.longitude|floatformat:6 }},{{ ground.latitude|floatformat:6 }},{{ ground.longitude|floatformat:6 }},{{ ground.latitude|floatformat:6 }}&layer=mapnik" allowfullscreen></iframe>
                  {% else %}
                    <iframe width="100%" height="450" frameborder="0" style="border:0"
                      src="https://maps.google.com/maps?q={{ ground.location|urlencode }}&output=embed"></iframe>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <p class="text-muted mb-0">No grounds are available right now.</p>
      </div>
    {% endfor %}
  </div>
</div>

{% endblock %}
